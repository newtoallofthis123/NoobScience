---
import Base from '../../layouts/base.astro';
import HomeNav from '../../components/navigation/home_nav';
import { getEntry } from 'astro:content';
import { Image } from 'astro:assets';

const {slug} = Astro.params

//@ts-ignore
const blogPost = await getEntry('blog', slug)
if(!blogPost){
    return Astro.redirect('/404')
}
const frontmatter = blogPost?.data;
const meta = await blogPost?.render()
const BASE_URL = Astro.url.host

//@ts-ignore
const {Content} = await blogPost?.render()
---

<Base
    description={frontmatter?.description}
    img={frontmatter?.img?.src || "/assets/banner.png"}
    selection_only={frontmatter?.selection_only}
    color={frontmatter?.color}
    bg={frontmatter?.bg}
    selection_bg={frontmatter?.selection_bg}
    selection_color={frontmatter?.selection_color}
    title={(frontmatter?.type == "notes")?(frontmatter?.title + " | Ishan's Jots"):(frontmatter?.title + " | Ishan Writes")}
>
    <HomeNav
        title={frontmatter?.title}
        color={frontmatter?.color}
        bg={frontmatter?.bg}
        client:load
    />
    <div
        id="content"
        class="flex flex-col justify-center items-center"
    >
        <div class={
            (frontmatter?.full_img)?"section_colored text-center":"cool"
        }>
            <div class="md:pt-2 pt-4 flex flex-col justify-center items-center">
                <div class={` ${(frontmatter?.full_img)?"md:w-full": (frontmatter?.img)?"md:3/5":"md:w-4/5"}  p-4`}>
                    <h1
                    class={` ${(frontmatter?.full_img)?"md:text-7xl":"md:text-5xl"} text-4xl font-heading md:py-3`}
                >
                {
                    !frontmatter?.full_img &&
                    (
                        <p onclick={`navigator.clipboard.writeText('http://${BASE_URL}/e/${
                            //@ts-ignore
                            frontmatter.emoji}')`} class="md:text-6xl text-4xl md:mb-8 mb-4 cursor-pointer"
                        >{
                            //@ts-ignore
                            frontmatter.emoji}
                        </p>
                    )
                }
                {
                    frontmatter?.full_img &&
                    (
                        <span onclick={`navigator.clipboard.writeText('http://${BASE_URL}/e/${frontmatter.emoji}')`} class="md:text-8xl text-4xl md:mb-8 mb-4 mr-4 cursor-pointer"
                        >{frontmatter.emoji}
                        </span>
                    )
                }
                    {frontmatter?.title}
                </h1>
                <p class="md:text-3xl text-lg md:py-5 py-2">
                    {frontmatter?.date.toDateString()} • {
                        meta?.remarkPluginFrontmatter?.minutesRead
                    } • {
                        meta?.remarkPluginFrontmatter?.wordsRead
                    } words
                </p>
                </div>
                {
                    frontmatter?.img && (
                        <div class={`py-1 items-center w-full ${(frontmatter.full_img)?"md:w-full":"md:w-3/5"}`}>
                            <Image
                                class={`${(frontmatter.full_img)?"rounded-none":"rounded-md"}`}
                                src={frontmatter.img}
                                alt={frontmatter?.title}
                            />
                        </div>
                    )
                }
            </div>
        </div>
        <div class="md:px-10 px-4 md:w-4/6 w-full flex flex-col">
            <Content />
            <span class="block w-40 h-1 mt-5 my-5 bg-blue-800"></span>
            <span class="block w-40 h-1 mb-5 bg-red-600"></span>
            <h3
                class="md:text-4xl text-2xl font-heading leading-relaxed md:py-5"
            >
                Posted in <a
                    href={'/categories/' + frontmatter?.category}
                    class="">@{frontmatter?.category}</a
                >
            </h3>
            <div class="flex md:flex-row flex-col">
                {
                frontmatter?.tags.map((tag: string) => {
                    return (
                        <div class="md:text-2xl text-xl pr-5">
                            <a href={'/tags/' + tag} class="">
                                #{tag}
                            </a>
                        </div>
                    );
                })
                }
            </div>
        </div>
    </div>
    <style define:vars={{
        section_bg: frontmatter?.bg,
        section_color: frontmatter?.color,
    }}>
        .section_colored {
            background-color: var(--section_bg);
            color: var(--section_color);
        }
    </style>
</Base>
